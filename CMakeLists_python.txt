cmake_minimum_required(VERSION 3.12)
project(storex_python)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Find required packages
find_package(pybind11 REQUIRED)

# Include directories
include_directories(include/)
include_directories(src/)

# Collect source files
file(GLOB_RECURSE STOREX_SOURCES "src/*.cpp")

# Create Python module
pybind11_add_module(storex 
    python/bindings.cpp
    ${STOREX_SOURCES}
)

# Compiler-specific options
target_compile_definitions(storex PRIVATE VERSION_INFO="0.1.0")

# Optimization flags
if(CMAKE_CXX_COMPILER_ID MATCHES "GNU|Clang")
    target_compile_options(storex PRIVATE -O3 -march=native -ffast-math)
elseif(CMAKE_CXX_COMPILER_ID MATCHES "MSVC")
    target_compile_options(storex PRIVATE /O2)
endif()

# Set properties
set_target_properties(storex PROPERTIES
    CXX_VISIBILITY_PRESET "hidden"
    INTERPROCEDURAL_OPTIMIZATION TRUE
)
